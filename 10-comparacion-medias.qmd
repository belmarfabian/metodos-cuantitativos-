# Comparación de medias {#comparacion}

*Última actualización: 7 de diciembre de 2024, 15:30 hrs.*

## Objetivos del capítulo {.unnumbered}

Al finalizar este capítulo, serás capaz de:

- Realizar pruebas t para comparar medias entre dos grupos
- Distinguir entre pruebas t para muestras independientes y pareadas
- Usar ANOVA para comparar medias de más de dos grupos
- Interpretar correctamente los resultados en R

```{r setup-10, include=FALSE}
library(tidyverse)
library(knitr)

theme_set(theme_minimal(base_size = 11))
```

## ¿Cuándo comparamos medias?

En ciencias sociales frecuentemente queremos saber si hay diferencias entre grupos:

- ¿Hombres y mujeres tienen ingresos diferentes?
- ¿Cambió la opinión pública antes y después de un evento?
- ¿Hay diferencias en confianza institucional según nivel educativo?

Para responder estas preguntas usamos **pruebas de comparación de medias**.

## Prueba t: La idea básica

La **prueba t** nos ayuda a determinar si la diferencia que observamos entre dos grupos es **real** (estadísticamente significativa) o si podría deberse simplemente al **azar** del muestreo.

::: {.callout-tip}
## La pregunta que responde la prueba t

"¿Es la diferencia entre estos grupos lo suficientemente grande como para concluir que existe una diferencia real en la población, o podría ser solo casualidad?"
:::

## Prueba t para dos grupos independientes

Esta es la prueba más común. Comparamos las medias de **dos grupos diferentes** (por ejemplo, hombres vs. mujeres).

**Ejemplo:** ¿Existe brecha salarial entre hombres y mujeres?

```{r t-test-ejemplo, echo=TRUE}
# Datos simulados: ingresos por género (en miles de pesos)
set.seed(2024)
ingresos_hombres <- rlnorm(150, meanlog = log(750), sdlog = 0.6)
ingresos_mujeres <- rlnorm(150, meanlog = log(650), sdlog = 0.6)

# Prueba t para dos grupos
t.test(ingresos_hombres, ingresos_mujeres)
```

**¿Cómo interpretar el resultado?**

1. **p-value**: Si es menor a 0.05, hay diferencia significativa
2. **Intervalo de confianza**: Si NO incluye el cero, la diferencia es significativa
3. **Medias de cada grupo**: Nos dice cuál grupo tiene mayor promedio

En este caso, p < 0.05 y el intervalo no incluye cero, así que **sí hay diferencia significativa** en ingresos.

```{r viz-t-simple, echo=FALSE, fig.cap="Comparación de ingresos por género", fig.height=3.5}
datos_ingresos <- data.frame(
  ingreso = c(ingresos_hombres, ingresos_mujeres),
  genero = rep(c("Hombres", "Mujeres"), each = 150)
)

ggplot(datos_ingresos, aes(x = genero, y = ingreso, fill = genero)) +
  geom_boxplot(alpha = 0.7, show.legend = FALSE) +
  labs(x = NULL, y = "Ingreso (miles de pesos)",
       title = "Distribución de ingresos por género") +
  theme_minimal()
```

## Prueba t pareada

Usamos esta prueba cuando medimos a **las mismas personas** en dos momentos diferentes.

**Ejemplo:** ¿Una intervención mejoró la percepción de seguridad?

```{r t-pareada, echo=TRUE}
# Medimos a las mismas 50 personas antes y después
set.seed(123)
antes <- rnorm(50, mean = 4.2, sd = 1.5)
despues <- antes + rnorm(50, mean = 0.8, sd = 1.0)

# Prueba t pareada (¡importante el paired = TRUE!)
t.test(despues, antes, paired = TRUE)
```

El p-value < 0.05 indica que **sí hubo un cambio significativo** después de la intervención.

::: {.callout-important}
## ¿Cuándo usar cada prueba t?

| Situación | Prueba | Código en R |
|-----------|--------|-------------|
| Dos grupos diferentes | t independiente | `t.test(grupo1, grupo2)` |
| Mismas personas, dos mediciones | t pareada | `t.test(despues, antes, paired = TRUE)` |
:::

## ANOVA: Comparar tres o más grupos

Cuando tenemos **más de dos grupos**, no podemos hacer múltiples pruebas t (aumenta el riesgo de error). Usamos **ANOVA** (Análisis de Varianza).

**Ejemplo:** ¿La confianza en el Congreso varía según nivel educativo?

```{r anova-simple, echo=TRUE}
# Datos: confianza en el Congreso según educación
set.seed(456)
datos <- data.frame(
  educacion = rep(c("Básica", "Media", "Superior"), each = 80),
  confianza = c(
    rnorm(80, mean = 3.2, sd = 1.8),
    rnorm(80, mean = 2.8, sd = 1.6),
    rnorm(80, mean = 2.3, sd = 1.5)
  )
)

# ANOVA
modelo <- aov(confianza ~ educacion, data = datos)
summary(modelo)
```

**¿Cómo interpretar?**

- Miramos el **Pr(>F)** (p-value)
- Si p < 0.05, **al menos un grupo es diferente** a los demás

```{r viz-anova-simple, echo=FALSE, fig.cap="Confianza en el Congreso según educación", fig.height=3.5}
datos$educacion <- factor(datos$educacion, levels = c("Básica", "Media", "Superior"))

ggplot(datos, aes(x = educacion, y = confianza, fill = educacion)) +
  geom_boxplot(alpha = 0.7, show.legend = FALSE) +
  labs(x = "Nivel educativo", y = "Confianza (escala 1-10)",
       title = "Confianza en el Congreso según educación") +
  theme_minimal()
```

#### ¿Cuáles grupos son diferentes? Test de Tukey

ANOVA solo dice que hay diferencias, pero no cuáles. Para eso usamos **Tukey**:

```{r tukey-simple, echo=TRUE}
TukeyHSD(modelo)
```

Miramos la columna **p adj**: si es < 0.05, esos dos grupos son significativamente diferentes.

## Resumen: ¿Qué prueba usar?

```{r tabla-resumen, echo=FALSE}
tabla <- data.frame(
  Situacion = c("Comparar 2 grupos diferentes",
                "Comparar antes/después (mismas personas)",
                "Comparar 3 o más grupos"),
  Prueba = c("t independiente", "t pareada", "ANOVA"),
  Codigo = c("t.test(A, B)", "t.test(despues, antes, paired=TRUE)", "aov(y ~ grupo, data)")
)
kable(tabla, col.names = c("Situación", "Prueba", "Código en R"))
```

::: {.callout-note}
## Lo más importante

1. **p < 0.05** → Diferencia significativa (rechazamos H₀)
2. **p ≥ 0.05** → No hay evidencia suficiente de diferencia
3. Siempre **visualiza tus datos** antes de hacer la prueba
:::

## Lecturas recomendadas {.unnumbered}

Agresti, A., & Finlay, B. (2009). *Statistical Methods for the Social Sciences* (4th ed.). Pearson.
→ Capítulo 7 cubre pruebas t con ejemplos claros.

Llaudet, E., & Imai, K. (2022). *Data Analysis for Social Science*. Princeton University Press.
→ Explicación accesible de comparación de grupos.

## Ejercicios {.unnumbered}

Los ejercicios para este capítulo se encuentran en el [Anexo de Ejercicios](#ejercicios-cap10).

::: {#refs}
:::
