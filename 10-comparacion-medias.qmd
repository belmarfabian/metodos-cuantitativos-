# Comparación de medias {#comparacion}

```{r setup-10, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(ggplot2)
```

## Objetivos del capítulo {.unnumbered}

Al finalizar este capítulo, serás capaz de:

- Realizar pruebas t para comparar medias entre dos grupos
- Distinguir entre pruebas t para muestras independientes y pareadas
- Comprender los supuestos de las pruebas paramétricas
- Usar ANOVA para comparar medias de más de dos grupos
- Identificar cuándo usar alternativas no paramétricas

## Prueba t para una muestra

La prueba t para una muestra compara la media de una muestra con un valor teórico o poblacional.

**Hipótesis:**
- $H_0: \mu = \mu_0$
- $H_1: \mu \neq \mu_0$

**Estadístico t:**
$$t = \frac{\bar{x} - \mu_0}{s / \sqrt{n}}$$

## Prueba t para dos muestras

### Muestras independientes

Comparamos las medias de dos grupos independientes.

**Hipótesis:**
- $H_0: \mu_1 = \mu_2$
- $H_1: \mu_1 \neq \mu_2$

**Estadístico t:**
$$t = \frac{\bar{x}_1 - \bar{x}_2}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}}$$

Consideremos un caso concreto para ilustrar esta prueba: la comparación de ingresos promedio entre hombres y mujeres en Chile.

```{r t-test-dos-muestras, echo=TRUE}
# Datos simulados: Diferencia salarial por género
set.seed(2024)
ingresos_hombres <- rlnorm(150, meanlog = log(750), sdlog = 0.6)
ingresos_mujeres <- rlnorm(150, meanlog = log(650), sdlog = 0.6)

# Prueba t para dos muestras independientes
resultado <- t.test(ingresos_hombres, ingresos_mujeres)
print(resultado)
```

### Muestras pareadas

Para datos pareados (mismo sujeto medido dos veces, o pares emparejados) se requiere una prueba t específica que reconoce la dependencia entre observaciones. Consideremos el caso de evaluación de una intervención policial sobre percepción de seguridad, donde medimos a los mismos individuos antes y después de la intervención:

```{r t-test-pareado, echo=TRUE}
# Datos: Percepción de seguridad antes y después de intervención policial
set.seed(123)
antes <- rnorm(50, mean = 4.2, sd = 1.5)
despues <- antes + rnorm(50, mean = 0.8, sd = 1.0)  # Mejora promedio

# Prueba t pareada
resultado <- t.test(despues, antes, paired = TRUE)
print(resultado)
```

## ANOVA: Comparar más de dos grupos

Cuando queremos comparar las medias de **tres o más grupos**, la prueba t no es apropiada porque haríamos múltiples comparaciones, aumentando la probabilidad de error tipo I. El **ANOVA** (Analysis of Variance) resuelve esto comparando todos los grupos simultáneamente.

**Hipótesis:**

- $H_0$: Todas las medias son iguales ($\mu_1 = \mu_2 = \mu_3 = ...$)
- $H_1$: Al menos una media es diferente

**Ejemplo:** Comparamos la satisfacción con la democracia según orientación política (izquierda, centro, derecha).

```{r anova-ejemplo, echo=TRUE}
# Datos simulados: satisfacción con democracia por orientación política
set.seed(2024)
n_grupo <- 100

datos_anova <- data.frame(
  satisfaccion = c(
    rnorm(n_grupo, mean = 4.5, sd = 1.2),  # Izquierda
    rnorm(n_grupo, mean = 5.2, sd = 1.1),  # Centro
    rnorm(n_grupo, mean = 4.0, sd = 1.3)   # Derecha
  ),
  orientacion = rep(c("Izquierda", "Centro", "Derecha"), each = n_grupo)
)

# ANOVA de una vía
modelo_anova <- aov(satisfaccion ~ orientacion, data = datos_anova)
summary(modelo_anova)
```

**Interpretación:** Si el valor p es menor a 0.05, rechazamos $H_0$ y concluimos que al menos un grupo tiene una media significativamente diferente.

```{r anova-plot, echo=TRUE, fig.cap="Satisfacción con democracia por orientación política"}
library(ggplot2)

ggplot(datos_anova, aes(x = orientacion, y = satisfaccion, fill = orientacion)) +
  geom_boxplot(alpha = 0.7, show.legend = FALSE) +
  stat_summary(fun = mean, geom = "point", shape = 18, size = 4, color = "red") +
  labs(x = "Orientación política",
       y = "Satisfacción con la democracia (1-7)",
       title = "Satisfacción según orientación política",
       subtitle = "Punto rojo = media del grupo") +
  theme_minimal()
```

::: {.nivel data-nivel="avanzado"}
### Comparaciones post-hoc

Si ANOVA indica diferencias significativas, ¿entre qué grupos están las diferencias? Las pruebas **post-hoc** (como Tukey HSD) comparan todos los pares de grupos controlando el error tipo I.

```{r posthoc, echo=TRUE}
# Comparaciones post-hoc de Tukey
TukeyHSD(modelo_anova)
```

**Interpretación:** El intervalo de confianza que no incluye 0 indica diferencia significativa entre esos dos grupos.
:::

## Supuestos de las pruebas paramétricas

Las pruebas t y ANOVA asumen:

1. **Independencia**: Las observaciones son independientes entre sí
2. **Normalidad**: Los datos en cada grupo se distribuyen normalmente
3. **Homogeneidad de varianzas**: Las varianzas de los grupos son similares

::: {.callout-tip}
## ¿Qué tan importantes son los supuestos?

En la práctica:

- **Independencia** es el supuesto más importante. Si no se cumple, los resultados pueden ser muy sesgados.
- **Normalidad** es menos crítica con muestras grandes (n > 30 por grupo) gracias al teorema del límite central.
- **Homogeneidad** puede relajarse usando versiones corregidas de las pruebas (como el ajuste de Welch en t.test).
:::

::: {.nivel data-nivel="avanzado"}
### Alternativas no paramétricas

Cuando los supuestos no se cumplen, especialmente con muestras pequeñas, usamos pruebas no paramétricas:

| Prueba paramétrica | Alternativa no paramétrica |
|-------------------|---------------------------|
| t de una muestra | Wilcoxon signed-rank |
| t de dos muestras independientes | Mann-Whitney U |
| t pareada | Wilcoxon signed-rank pareada |
| ANOVA | Kruskal-Wallis |

```{r no-parametrico, echo=TRUE}
# Ejemplo: Mann-Whitney U (alternativa a t de dos muestras)
wilcox.test(ingresos_hombres, ingresos_mujeres)

# Ejemplo: Kruskal-Wallis (alternativa a ANOVA)
kruskal.test(satisfaccion ~ orientacion, data = datos_anova)
```
:::

## ¿Qué prueba usar?

| Situación | Prueba recomendada |
|-----------|-------------------|
| Comparar una media con un valor teórico | t de una muestra |
| Comparar medias de 2 grupos independientes | t de dos muestras |
| Comparar medias antes/después (mismos sujetos) | t pareada |
| Comparar medias de 3+ grupos | ANOVA |

## Resumen {.unnumbered}

| Concepto | Descripción | Función en R |
|----------|-------------|--------------|
| **t una muestra** | Compara media vs valor teórico | `t.test(x, mu = valor)` |
| **t dos muestras** | Compara medias de 2 grupos | `t.test(x, y)` |
| **t pareada** | Mismos sujetos, dos mediciones | `t.test(x, y, paired = TRUE)` |
| **ANOVA** | Compara 3+ grupos | `aov(y ~ grupo)` |

**Supuestos clave:** independencia (crítico), normalidad (flexible con n>30), homogeneidad de varianzas.

## Lecturas recomendadas {.unnumbered}

**Fundamentos de comparación de grupos:**

Agresti, A., & Finlay, B. (2009). *Statistical Methods for the Social Sciences* (4th ed.). Pearson.  
→ Capítulo 7 cubre pruebas t y comparación de medias entre dos grupos con claridad y ejemplos aplicados.

**Inferencia causal mediante comparación de grupos:**

Llaudet, E., & Imai, K. (2022). *Data Analysis for Social Science: A Friendly and Practical Introduction*. Princeton University Press.  
→ Capítulo 3 sobre causalidad conecta comparación de medias con diseños experimentales y cuasi-experimentales.

**ANOVA y diseños más complejos:**

Maxwell, S. E., Delaney, H. D., & Kelley, K. (2018). *Designing Experiments and Analyzing Data: A Model Comparison Perspective* (3rd ed.). Routledge.  
→ Tratamiento comprehensivo de ANOVA y diseños factoriales para investigadores avanzados.


## Ejercicios {.unnumbered}

::: {.ejercicios}

**1. Prueba t de una muestra**

Una escala de confianza interpersonal tiene media nacional de 5.5 (escala 1-10). Tienes datos de una región específica:

```{r eval=FALSE}
set.seed(111)
confianza_region <- rnorm(80, mean = 4.8, sd = 2.0)
```

a) Formula las hipótesis
b) Realiza la prueba t
c) Calcula el IC 95%
d) ¿La región difiere significativamente del promedio nacional?

**2. Prueba t de dos muestras**

Comparamos participación cívica entre hombres y mujeres:

```{r eval=FALSE}
set.seed(222)
civic_hombres <- rnorm(100, mean = 3.2, sd = 1.5)
civic_mujeres <- rnorm(110, mean = 3.8, sd = 1.4)
```

a) Formula las hipótesis
b) Realiza la prueba t para muestras independientes
c) Calcula e interpreta el IC para la diferencia de medias
d) ¿Cuál es el tamaño del efecto (d de Cohen)?
e) Crea un gráfico comparando ambos grupos

**3. Prueba t pareada**

Mediciones de actitud hacia inmigración antes y después de ver un documental:

```{r eval=FALSE}
set.seed(333)
n <- 60
antes <- rnorm(n, mean = 50, sd = 15)
# El documental tiene efecto positivo pequeño
despues <- antes + rnorm(n, mean = 5, sd = 8)
```

a) ¿Por qué es apropiada una prueba pareada aquí?
b) Realiza la prueba
c) Calcula el cambio promedio y su IC
d) Crea un gráfico antes-después (ej: líneas conectando puntos)

**4. ANOVA**

Satisfacción con servicios públicos según región:

```{r eval=FALSE}
set.seed(444)
datos_anova <- data.frame(
  satisfaccion = c(
    rnorm(50, mean = 5.5, sd = 1.2),  # Norte
    rnorm(60, mean = 4.8, sd = 1.3),  # Centro
    rnorm(55, mean = 5.2, sd = 1.1),  # Sur
    rnorm(45, mean = 4.5, sd = 1.4)   # Metropolitana
  ),
  region = rep(c("Norte", "Centro", "Sur", "Metropolitana"), c(50, 60, 55, 45))
)
```

a) Realiza ANOVA de una vía
b) ¿Hay diferencias significativas entre regiones?
c) Realiza análisis post-hoc de Tukey
d) ¿Entre qué pares de regiones hay diferencias significativas?
e) Crea visualización comparativa (boxplots)

**5. Verificación de supuestos**

Con los datos de ANOVA del ejercicio anterior:

a) Evalúa normalidad en cada grupo (histogramas o test de Shapiro-Wilk)
b) Evalúa homogeneidad de varianzas (test de Levene o comparación visual)
c) ¿Se cumplen los supuestos? Si no, ¿qué alternativa usarías?
d) Realiza la alternativa no paramétrica (Kruskal-Wallis) y compara conclusiones

**6. Proyecto integrador**

Con datos de tu interés (ej: encuesta de opinión):

a) Formula una pregunta de comparación de grupos
b) Identifica la prueba apropiada
c) Verifica supuestos
d) Realiza la prueba e interpreta
e) Calcula tamaño del efecto
f) Crea visualización publicable
g) Escribe un párrafo de resultados como aparecería en un paper

:::

::: {#refs}
:::
